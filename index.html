<!DOCTYPE html>
<html>
<head>
<style>
.background {
    position: fixed;
    left: 0;
    right: 0;
    z-index: -1;
    display: block;
    background-image: url("background-silver.jpg");
    filter: brightness(0.5);
    height: 100%;
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
}
video { 
    position: fixed;
    left: 0;
    right: 0;
    z-index: -100;
    display: block;
    filter: brightness(0.8);
    filter: contrast(0.7) brightness(0.8) grayscale(0.5) hue-rotate(20deg);
    height: 100%;
    background-position: center;
    background-repeat: no-repeat;
    background-size: cover;
}
div#drawing {
    position: fixed;
    left: 0;
    right: 0;
    display: block;
}
</style>
  <title>Voting</title>
</head>
<body>
  <video autoplay muted loop poster="background/polygon.jpg" id="video">
    <source src="background/polygon.mp4" type="video/mp4" id="background">
  </video>
  <div id="drawing"></div>
  <script type="text/javascript" src="svg.js"></script>
  <script type="text/javascript">

    var draw

    var votes = [
        { flag: "HU", name: "Hungary",        votes: 54 },
        { flag: "DE", name: "Germany",        votes: 58 },
        { flag: "SE", name: "Sweden",         votes: 63 },
        { flag: "PL", name: "Poland",         votes: 61 },
        { flag: "GR", name: "Greece",         votes: 59 },
        { flag: "IT", name: "Italy",          votes: 69 },
        { flag: "IE", name: "Ireland",        votes: 73 },
        { flag: "GB", name: "United Kingdom", votes: 51 },
        { flag: "IS", name: "Iceland",        votes: 72 },
        { flag: "RU", name: "Russia",         votes: 67 },
        { flag: "NO", name: "Norway",         votes: 23 }
        ]

    function compare(a, b) {
      if (a.votes>b.votes) { return -1; }
      if (a.votes<b.votes) { return  1; }
      if (a.flag<b.flag)   { return -1; }
      if (a.flag>b.flag)   { return  1; }
      return 0;
    }

    /* Populate the per-country SVG group */
    function country(draw, flag, name, score) {

        var nested = draw.nested().id(flag)

        grad = nested.gradient('radial', function(stop) {
              stop.at(0, '#444')
              stop.at(1, '#aaa')
            })

        nested.rect(560, 64).attr({ fill: grad, opacity: 0.3 })

        nested.image('flag/' + flag + ".png")
            .move(20,0)

        nested.text(name)
            .font({ family: 'Helvetica', size: 40, weight: 'normal'})
            .move(64+40+4,10+4)
            .fill('#303030')

        nested.text(name)
            .font({ family: 'Helvetica', size: 40, weight: 'normal'})
            .move(64+40,10)
            .fill('#fff')

        nested.text(score)
            .id(flag + '_score')
            .font({ family: 'Helvetica', size: 40, weight: 'normal', anchor: 'end' })
            .move(540+4,10+4)
            .fill('#000')

        nested.text(score)
            .id(flag + '_score_shadow')
            .font({ family: 'Helvetica', size: 40, weight: 'normal', anchor: 'end' })
            .move(540,10)
            .fill('#fff')

        return nested
    }

    /* Initialise SVG, given initial votes */
    function init(draw, votes) {
        votes.sort(compare);
        for (var i = 0; i < votes.length && i < 6; i++) {
            country(draw, votes[i].flag, votes[i].name, votes[i].votes.toString())
            .attr({ x: 80, y: 100+i*80, 'opacity': 0.0 })
            .animate(2000, '>', 300*i).attr({ 'opacity': 1.0 })
        }

        for (var i = 6; i < 12 && i < votes.length; i++) {
            country(draw, votes[i].flag, votes[i].name, votes[i].votes.toString())
            .attr({ x: 750, y: 100+(i-6)*80, 'opacity': 0.0 })
            .animate(2000, '>', 300*i).attr({ 'opacity': 1.0 })
        }
    }

    /* Update SVG given updated votes */
    function update(draw, votes) {
        votes.sort(compare);
        for (var i = 0; i < votes.length && i < 6; i++) {
            SVG.get(votes[i].flag + '_score').text(votes[i].votes.toString())
            SVG.get(votes[i].flag + '_score_shadow').text(votes[i].votes.toString())
            SVG.get(votes[i].flag).animate(1000, '<>').move(80, 100+i*80)
        }

        for (var i = 6; i < 12 && i < votes.length; i++) {
            SVG.get(votes[i].flag + '_score').text(votes[i].votes.toString())
            SVG.get(votes[i].flag + '_score_shadow').text(votes[i].votes.toString())
            SVG.get(votes[i].flag).animate(1000, '<>').move(750, 100+(i-6)*80)
        }
    }

    function modify() {
        votes[Math.floor(Math.random()*votes.length)].votes += 10
        votes[Math.floor(Math.random()*votes.length)].votes += 5
        votes[Math.floor(Math.random()*votes.length)].votes += 2
        update(draw, votes)
        setTimeout(modify, 4000)
    }

    if (SVG.supported) {
        draw = SVG('drawing').size(1920, 1080)
        fill = draw.rect(1920, 1080).attr({ fill: '#000', opacity: 0.0 }).move(0,0)
        init(draw, votes)

        document.onkeypress = function(event){
            /* Show the votes */
            if (event.key=='1')
            {
                for (var i = 0; i < votes.length; i++)
                    SVG.get(votes[i].flag)
                        .animate(2000, '>', 100*i).attr({ 'opacity': 1.0 })
            }
            /* Hide the votes */
            if (event.key=='2')
            {
                for (var i = 0; i < votes.length; i++)
                    SVG.get(votes[i].flag)
                        .animate(1000, '<', 100*(votes.length-i)).attr({ 'opacity': 0.0 })
            }
            /* Show the background */
            if (event.key=='3')
            {
                fill.animate(1000, '<>', 100*(votes.length-i)).attr({ 'opacity': 0.0 })
            }
            /* Hide the background */
            if (event.key=='4')
            {
                fill.animate(2000, '<>', 100*(votes.length-i)).attr({ 'opacity': 1.0 })
            }

            if (event.key==' ')
            {
                video = document.getElementById("video");
                if (video.paused) { video.play(); } else { video.pause(); }
            }
        };

        modify()

        video = document.getElementById("video");
        video.playbackRate = 0.125;

    }
</script>
</body>
</html>